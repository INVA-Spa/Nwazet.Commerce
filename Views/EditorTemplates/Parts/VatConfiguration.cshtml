@using Nwazet.Commerce.ViewModels;
@using Nwazet.Commerce.Models;
@using Orchard.ContentManagement;
@using Orchard.Core.Title.Models;
@using System.Collections.Generic;

@model Nwazet.Commerce.ViewModels.VatConfigurationPartViewModel
@functions{
    IContentManager _contentManager;
}
@{
    _contentManager = WorkContext.Resolve<IContentManager>();
}

@helper DisplayTree(VatConfigurationTerritorySummaryViewModel item) { 
    <div class="vatTerritorySummaryRow" style="margin-left:15px">
        @Html.ItemEditLink(item.Name, item.Item) @(item.Rate >= 0 ? T(" ({0} %)", item.Rate) : T("No specific configuration"))
        @foreach(var subitem in item.SubRegions) {
            @DisplayTree(subitem)
        }
    </div>
}

<fieldset>
    <div>
        @Html.LabelFor(m => m.TaxProductCategory, T("Category").Text, new { @class = "sub" })
        @Html.TextBoxFor(m => m.TaxProductCategory, new { @class = "text text-medium", title = T("Product category") })
        <div>
            @if (Model.IsDefaultCategory) {
                @T("This is the default category.")
                @Html.HiddenFor(m => m.IsDefaultCategory)
            }
            else {
                <span class="checkbox-and-label">
                    @Html.CheckBoxFor(m => m.IsDefaultCategory)
                    @Html.LabelFor(m => m.IsDefaultCategory, T("Set this as the default category: ").Text, new { @class = "forcheckbox" })
                </span>
                <span class="hint">@T("Check to set this category as the default one.")</span>
            }
        </div>
        <span class="hint">@T("The product category this VAT will be applied to. The default category will apply to all products where a category was not specified.")</span>
    </div>
    <div>
        @Html.LabelFor(m => m.Priority, T("Priority").Text, new { @class = "sub" })
        @Html.TextBoxFor(m => m.Priority, new { @class = "text text-small", pattern = "[0-9]", @type = "number" })
        <span class="hint">@T("The priority to apply this tax. The highest priority wins. This makes it possible to create a hierarchy of taxes.")</span>
    </div>
    <div>
        @*@Html.LabelFor(m => m.DefaultRate, T("Default Rate for territories outside the hierarchy").Text, new { @class = "sub" })*@
        @Html.HiddenFor(m => m.DefaultRate)
        @*<span class="hint">@T("The default percent rate for this VAT that will be applied when the destination for products is not found in any of the hierarchies for territories selected for this VAT configuration.")</span>*@
    </div>
    <div>
        @if (Model.ItemizedSummary.Any()) {
            @T("This VAT category is configured for the following regions:")

            foreach (var item in Model.ItemizedSummary) {
                <div class="vatConfigurationSummaryTable">
                    <div class="vatHierarchySummaryRow" style="margin-left:15px">
                        @Html.ItemEditLink(item.Name, item.Item) @T(" ({0} %)", item.Rate)
                        @foreach(var subitem in item.SubRegions) {
                            @DisplayTree(subitem)
                        }
                    </div>
                </div>
            }
        }
        else {
            @T("There are no hierarchy configurations for this VAT category.")
        }
    </div>
</fieldset>
