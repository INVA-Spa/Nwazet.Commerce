@using Orchard.Core.Contents.ViewModels;
@using Nwazet.Commerce.Models
@using Orchard.ContentManagement.MetaData.Models;
@using DiscountProduct = Nwazet.Commerce.ViewModels.DiscountProduct
@using ContentsProduct = Nwazet.Commerce.ViewModels.ContentsProduct

@{
    Style.Require("Accordion").AtHead();

    var pageTitle = T("Manage Products");
    var createLinkText = T("Create New Product");
    Layout.Title = pageTitle;

    var AllowedProductTypes = Model.AllowedProductTypes == null
        ? new List<ContentTypeDefinition>()
        : (List<ContentTypeDefinition>)Model.AllowedProductTypes;

    IEnumerable<string> cultures = Model.Options.Cultures;

}
<div class="row">
    <div class="manage">
        @*@Html.ActionLink(createLinkText.Text, "Create", "Admin", new { Area = "Contents", Id = "Product" }, new { @class = "button primaryAction" })*@
        @if (AllowedProductTypes.Any()) {
            @Html.ActionLink(createLinkText.Text,
                   "CreateProduct",
                   "ProductAdmin",
                   new {
                       Area = "Nwazet.Commerce",
                       ReturnUrl = Request.RawUrl,
                       id = AllowedProductTypes.Count() == 1 ? AllowedProductTypes.FirstOrDefault().Name : ""
                   },
                   new { @class = "button primaryAction" })
        }
    </div>
</div>
@using (Html.BeginFormAntiForgeryPost()) {
    <div>
        <div class="box-header with-border">
            <h3 class="box-title">@T("Content filtering")</h3>
        </div>
        <div class="box-body">
            <div class="row">
                <div class="col-xs-12 col-md-4 col-lg-4 margin-bottom-lg">
                    <label for="title">@T("Title:")</label>
                    <input class="text" type="text" name="Options.Title" value="@(Model.Options.Title)" />
                </div>
                <div class="col-xs-12 col-md-4 col-lg-4 margin-bottom-lg">
                    <label for="sku">@T("Sku"):</label>
                    <input class="text" type="text" name="Options.Sku" value="@(Model.Options.Sku)" />
                </div>
                @if (((IEnumerable<KeyValuePair<string, string>>)Model.Options.FilterOptions).Count() > 1) {
                    <div class="col-xs-12 col-md-4 margin-bottom-lg">
                        <label for="filterResults">@T("Product Type"):</label>
                        <select id="filterResults" name="Options.SelectedFilter">
                            @Html.SelectOption((string)Model.Options.SelectedFilter, "", T("any (show all)").ToString())
                            @foreach (var filterOption in Model.Options.FilterOptions) {
                                @Html.SelectOption((string)Model.Options.SelectedFilter, (string)filterOption.Key, (string)filterOption.Value)
                            }
                        </select>
                    </div>
                }
                @if (cultures.Count() > 1) {
                    <div class="col-xs-12 col-md-4 margin-bottom-lg">
                        <label for="filterCulture">@T("Culture"):</label>
                        <select id="filterCulture" name="Options.SelectedCulture">
                            @Html.SelectOption((string)Model.Options.SelectedCulture, "", T("any (show all)").ToString())
                            @foreach (string culture in cultures) {
                                @Html.SelectOption((string)Model.Options.SelectedCulture, culture, System.Globalization.CultureInfo.GetCultureInfo(culture).DisplayName)
                            }
                        </select>
                    </div>
                }
            </div>
        </div>
        <div class="box-body">
            <div class="row">
                <div class="col-xs-12 col-md-12 col-lg-12 margin-bottom-lg">
                    <a class="accordion-section-title" role="button" data-toggle="collapse" href="#collapserow" aria-expanded="false" aria-controls="collapseExample">@T("Advanced filters")</a>
                </div>
            </div>
        </div>
        <div id="collapserow" class="collapse">
            <div class="col-xs-12 col-md-3 col-lg-3 margin-bottom-lg">
                <label for="priceFromResults">@T("Price From")</label>
                <input class="av-textbox ui-autocomplete-input" type="text" name="Options.PriceFrom" value="@(Model.Options.PriceFrom)" />
            </div>
            <div class="col-xs-12 col-md-3 col-lg-3 margin-bottom-lg">
                <label for="priceToResults">@T("Price To")</label>
                <input class="av-textbox ui-autocomplete-input" type="text" name="Options.PriceTo" value="@(Model.Options.PriceTo)" />
            </div>
            <div class="col-xs-12 col-md-3 col-lg-3 margin-bottom-lg">
                <label for="inventoryFromResults">@T("Inventory From")</label>
                <input class="av-textbox ui-autocomplete-input" type="text" name="Options.InventoryFrom" value="@(Model.Options.InventoryFrom)" />
            </div>
            <div class="col-xs-12 col-md-3 col-lg-3 margin-bottom-lg">
                <label for="inventoryToResults">@T("Inventory To")</label>
                <input class="av-textbox ui-autocomplete-input" type="text" name="Options.InventoryTo" value="@(Model.Options.InventoryTo)" />
            </div>
            <div class="col-xs-12 col-md-4 col-lg-4 margin-bottom-lg">
                <label class="gray-label">@T("Status"):</label>
                <select id="contentResults" name="Options.ContentsStatus">
                    @Html.SelectOption((ContentsStatus)Model.Options.ContentsStatus, ContentsStatus.Latest, T("latest").ToString())
                    @Html.SelectOption((ContentsStatus)Model.Options.ContentsStatus, ContentsStatus.Published, T("published").ToString())
                    @Html.SelectOption((ContentsStatus)Model.Options.ContentsStatus, ContentsStatus.Draft, T("unpublished").ToString())
                    @Html.SelectOption((ContentsStatus)Model.Options.ContentsStatus, ContentsStatus.AllVersions, T("all versions").ToString())
                </select>
            </div>
            <div class="col-xs-12 col-md-4 col-lg-4 margin-bottom-lg">
                <label for="discountChoose">@T("Discount"):</label>
                <select id="discountChoose" name="Options.FilterDiscount">
                    @Html.SelectOption((DiscountProduct)Model.Options.FilterDiscount, DiscountProduct.ShowAll, T("any (show all)").Text)
                    @Html.SelectOption((DiscountProduct)Model.Options.FilterDiscount, DiscountProduct.Discount, T("Discount").Text)
                    @Html.SelectOption((DiscountProduct)Model.Options.FilterDiscount, DiscountProduct.NoDiscount, T("No Discount").ToString())
                </select>
            </div>
        </div>

        <div class="col-xs-12 col-md-12 col-xl-12 v-inline-middle">
            <label for="orderResults">@T("Ordered by"):</label>
            <select id="orderResults" name="Options.OrderBy">
                @Html.SelectOption((ContentsProduct)Model.Options.OrderBy, ContentsProduct.Created, T("recently created").Text)
                @Html.SelectOption((ContentsProduct)Model.Options.OrderBy, ContentsProduct.Modified, T("recently modified").Text)
                @Html.SelectOption((ContentsProduct)Model.Options.OrderBy, ContentsProduct.Published, T("recently published").ToString())
            </select>
        </div>
        <div class="box-footer align-right padding-right-35 col-xs-12 col-md-12">
            <button type="submit" name="submit.Filter" value="yes please">@T("Apply")</button>
        </div>
    </div>
    <fieldset class="contentItems bulk-items">
        @Display(Model.ContentItems)
    </fieldset>
    @Display(Model.Pager)
}
